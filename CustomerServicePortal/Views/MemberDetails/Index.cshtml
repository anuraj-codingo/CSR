@model CustomerServicePortal.Models.ClaimDetailDashBoardModel
@{
    ViewBag.Title = "Index";
}

<style>
    .modal.fade.in {
        opacity: 1;
    }

    .no-depend {
        font-size: 13px;
        padding: 10px 0px;
    }


    .table th, .table td {
        border-top: none !important;
    }
</style>

<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
@*<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>*@
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
<div class="user">
    <div class="box info">
        <div class="col-12">
            <div class="detail">
                <div class="profilePhoto">
                    <div class="photo">
                        @if (Model.eMPdetails.Gender == "F")
                        {
                            <img src="~/Content/img/lisa-dominic.png" alt="" />
                        }
                        else
                        {
                            <img src="~/Content/img/Men.png" alt="" />
                        }


                    </div>
                </div>
                <div class="intro">
                    <a onclick="Reset(@Model.eMPdetails.EMSSN)" href="#"><h4>@Model.eMPdetails.Name</h4></a>
                    <strong class="h6">ID: <span>@Model.eMPdetails.Id</span></strong>
                    <strong class="h6">Gender: <span>@Model.eMPdetails.Gender</span></strong>
                    <strong class="h6">DOB: <span>@(new DateTime(Convert.ToInt32(@Model.eMPdetails.DOBYear), Convert.ToInt32(@Model.eMPdetails.DOBMonth), Convert.ToInt32(@Model.eMPdetails.DOBDay)).ToString("MM/dd/yyyy"))</span></strong>
                    @if (Model.eMPdetails.ShowRequestId)
                    {
                        <button type="button" class="btn btn-primary IdCardRequest mb-2" onclick="IdCardRequest(@Model.eMPdetails.EMSSN,'@Model.eMPdetails.Name','@Model.eMPdetails.Gender')">Request ID Card</button>
                    }
                    
                <button type="button" class="btn btn-primary">Print Temporary ID Card</button>
                    @*<p>Lorem ipsum dolor sit amet, adipiscing consectetur elit.</p>*@
                </div>
            </div>
        </div>
        <div class="col-12 userTable-block">
            <table>
                <tr>
                    <th>Relation</th>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Plan</th>
                    <th>Class</th>
                    <th>DOB</th>
                    <th>Action</th>
                </tr>
                @if (Model.dependentDetailModels.Count > 0)
                {
                    foreach (var item in Model.dependentDetailModels)
                    {
                        <tr>
                            <td>@item.Relation</td>
                            <td><a onclick="GetSpouseCliamDetailTable(@item.SSN,@item.DependentSeq)" href="#"> @item.DependenetName</a> </td>
                            <td>@item.Status</td>
                            <td>@item.Plan</td>
                            <td>@item.Class</td>
                            <td>@(new DateTime(Convert.ToInt32(item.BirthYear), Convert.ToInt32(item.BirthMonth), Convert.ToInt32(item.BirthDay)).ToString("MM/dd/yyyy"))</td>
                            <td><i class="fa fa-pencil" onclick="EditDependent(@Model.eMPdetails.EMSSN,@item.DependentSeq)"></i></td>
                        </tr>
                    }

                }
                else
                {
                    <tr><td colspan="7" class="no-depend">No Dependant</td></tr>
                }
            </table>
            <button type="button" class="btn btn-primary" onclick="EditDependent(@Model.eMPdetails.EMSSN,0)"><i class="fa fa-plus"></i> Add Dependent</button>

        </div>
    </div>
    <div class="box archive">
        <div class="byYear">
            @if (Model.dEDMETModelCurentYear.Count > 0)
            {
                @Html.Partial("_DEDMET_OOP_PartialView", Model.dEDMETModelCurentYear)
            }
            @if (Model.dEDMETModelPreviousYear.Count > 0)
            {
                @Html.Partial("_DEDMET_OOP_PartialView", Model.dEDMETModelPreviousYear)
            }



        </div>
    </div>
    <div class="box">
        <h4>Address</h4>
        <p>
            @{
                var x = "";
            }

            @if (Model.eMPdetails.Addr1.Trim() != "" && Model.eMPdetails.Addr1 != null)
            {
                x += Model.eMPdetails.Addr1;
            }
            @if (Model.eMPdetails.Addr2.Trim() != "" && Model.eMPdetails.Addr2 != null)
            {
                x += "," + Model.eMPdetails.Addr2;
            }
            @if (Model.eMPdetails.Addr3.Trim() != "" && Model.eMPdetails.Addr3 != null)
            {
                x += "," + Model.eMPdetails.Addr3;
            }
            @if (Model.eMPdetails.Addr4.Trim() != "" && Model.eMPdetails.Addr4 != null)
            {
                x += "," + Model.eMPdetails.Addr4;
            }
            @if (Model.eMPdetails.City.Trim() != "" && Model.eMPdetails.City != null)
            {
                x += "," + Model.eMPdetails.City;
            }
            @if (Model.eMPdetails.State.Trim() != "" && Model.eMPdetails.State != null)
            {
                x += "," + Model.eMPdetails.State;
            }
            @if (Model.eMPdetails.Zip1.Trim() != "" && Model.eMPdetails.Zip1 != null)
            {
                x += "," + Model.eMPdetails.Zip1;
            }
            @if (Model.eMPdetails.Zip2.Trim() != "" && Model.eMPdetails.Zip2 != null)
            {
                x += "," + Model.eMPdetails.Zip2;
            }
            @if (Model.eMPdetails.Zip3.Trim() != "" && Model.eMPdetails.Zip3 != null)
            {
                x += "," + Model.eMPdetails.Zip3;
            }


            @x <button class="editBtn-block" href="" onclick="EditAddress(@Model.eMPdetails.EMSSN)"><i class="fa fa-pencil"></i></button>
        </p>
    </div>


</div>

<div class="searchFilter">
    <div class="download" onclick="ExportTable(@Model.eMPdetails.EMSSN)">
        <span>
            <input type="hidden" value="0" id="DEPSEQ" />
            <img src="~/Content/img/excel-icon.png" alt="" />
        </span>
    </div>
    <div class="inputWrap">
        <div class="inputField">
            <label>Service Date</label>
            <input type="text" name="servicedate" id="Fromservicedate" class="datepicker input-group date">
        </div>
        <div class="inputField">
            <label>To</label>
            <input type="text" name="to" id="Toservicedate" class="datepicker input-group date">
        </div>
        <div class="inputField">
            <label>Claim #</label>
            <input type="text" name="claim" id="claim">
        </div>
        <div class="inputField">
            <label>DEP #</label>
            <input type="text" name="dep" id="dep">
        </div>
        <div class="inputField">
            <input type="submit" value="Search" onclick="GetCliamDetailTable(@Model.eMPdetails.EMSSN)">
        </div>
        <div class="inputField">
            <input type="reset" value="Reset" onclick="Reset(@Model.eMPdetails.EMSSN)">
        </div>
    </div>
</div>
<div class="loader-main">
    <div class="loader-sub">
        <div class="loader2"></div>
    </div>
</div>
<div id="EditAddress" class="modal fade modalAddress" role="dialog">
    <div class="modal-dialog  modal-lg" role="document" style="margin-top: 144px;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Address</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            @*<form id="AddressUpdateSubmit">*@
            @using (Ajax.BeginForm("UpdateAddress", "MemberDetails",
                 new AjaxOptions
                 {
                     OnSuccess = "OnSuccess",
                     OnFailure = "OnFailure",
                     LoadingElementId = "progress"
                 }))
            {
                <div class="modal-body EditAddresshtml">



                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" onclick="AddressUpdateSubmit()">Save changes</button>
                </div>

            }
        </div>
    </div>
</div>
<div id="EditDependent" class="modal fade modalDependent" role="dialog">
    <div class="modal-dialog  modal-lg" role="document" style="margin-top: 144px;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Dependent</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            @*<form id="AddressUpdateSubmit">*@
            @using (Ajax.BeginForm("EditDependent", "MemberDetails",
                 new AjaxOptions
                 {
                     OnSuccess = "OnSuccess",
                     OnFailure = "OnFailure",
                     LoadingElementId = "progress"
                 }))
            {
                <div class="modal-body EditDependenthtml">



                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>

            }
        </div>
    </div>
</div>

<div id="ClaimExpanModel" class="modal fade modalAddress" role="dialog">
    <div class="modal-dialog mx-w-1200" role="document" style="margin-top: 144px;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Claim Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body ClaimExpanModelBody">



            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                @*<button type="submit" class="btn btn-primary" onclick="AddressUpdateSubmit()">Save changes</button>*@
            </div>


        </div>
    </div>
</div>
<div id="EOBExpanModel" class="modal fade modalAddress" role="dialog">
    <div class="modal-dialog mx-w-1200" role="document" style="margin-top: 144px;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row justify-content-end">
                    <button class="none-btn"><i class="fa fa-print" onclick="PrintEOB()"></i></button>
                </div>
                <div class="EOBExpanModelBody">

                </div>
            </div>
        </div>
    </div>
</div>
<!--/searchFilter-->
<div id="claimDetailGrid">
    @{Html.RenderPartial("_MemeberDetailsPartialView", Model.claimDetailModels);}
</div>
<script type=text/javascript>
    $('.datepicker').datepicker({
        dateFormat: 'mm-dd-yy',
        changeMonth: true,
        changeYear: true,
        yearRange: "-100:+100"
    });
    function PrintEOB() {

        var divContents = $(".EOBExpanModelBody").html();
        var printWindow = window.open('', '', 'height=400,width=800');
        //printWindow.document.write('<html><head><title>DIV Contents</title>');
        //printWindow.document.write('</head><body >');
        printWindow.document.write(divContents);
        //printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.print();
        //var doc = new jsPDF({
        //    orientation: 'portrait'
        //});
        //doc.setFontSize(16);
        //var elementHTML = $('#oReportDiv').html();
        //var specialElementHandlers = {
        //    '#elementH': function (element, renderer) {
        //        return true;
        //    }
        //};
        //doc.fromHTML(elementHTML, 100, 100, {
        //    'width': 500,
        //    'elementHandlers': specialElementHandlers
        //});

        //// Save the PDF
        //doc.save('sample-document.pdf');
    }
    function EditAddress(SSN) {
        $('.loader-main').show();
                  $.ajax({
                type: "GET",
                url:'@Url.Action("GetAddreessParialViewHtml", "MemberDetails")',
                data: {  SSN: SSN},
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (response6) {

                    $('.loader-main').hide();
                    $('.EditAddresshtml').html(response6.viewContent);

                    $('#EditAddress').modal('show');

                },
                failure: function (response6) {
                    alert(response6.d);
                },
                error: function (response6) {
                    alert(response6.d);
                }
            });

    }
      function EOBExpanModelpopup(SSN, Claimnumber) {
        $('.loader-main').show();
                  $.ajax({
                type: "GET",
                url:'@Url.Action("GetEOBDetailsHtml", "MemberDetails")',
                      data: { SSN: SSN, Claimnumber: Claimnumber},
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (response5) {
                    debugger;
                    $('.loader-main').hide();
                    $('.EOBExpanModelBody').html(response5.viewContent);

                    $('#EOBExpanModel').modal('show');

                },
                failure: function (response5) {
                    alert(response5.d);
                },
                error: function (response5) {
                    alert(response5.d);
                }
            });
    }
        function ClaimExpanModelpopup(SSN, Claimnumber) {
        $('.loader-main').show();
                  $.ajax({
                type: "GET",
                url:'@Url.Action("GetClaimDetailExpandModelHTml", "MemberDetails")',
                      data: { SSN: SSN, Claimnumber: Claimnumber},
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (response4) {

                    $('.loader-main').hide();
                    $('.ClaimExpanModelBody').html(response4.viewContent);

                    $('#ClaimExpanModel').modal('show');

                },
                failure: function (response4) {
                    alert(response4.d);
                },
                error: function (response4) {
                    alert(response4.d);
                }
            });
    }
    function EditDependent(SSN, DependentSeq) {
        $('.loader-main').show();
                  $.ajax({
                type: "GET",
                url:'@Url.Action("EditDependentHtml", "MemberDetails")',
                      data: { SSN: SSN, DependentSeq: DependentSeq},
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (response3) {

                    $('.loader-main').hide();
                    $('.EditDependenthtml').html(response3.viewContent);

                    $('#EditDependent').modal('show');
                    $('.datepicker').datepicker({
                        dateFormat: 'mm-dd-yy',
                        changeMonth: true,
                        changeYear: true,
                        yearRange: "-100:+100"
                    });
                },
                failure: function (response3) {
                    alert(response3.d);
                },
                error: function (response3) {
                    alert(response3.d);
                }
            });
    }

    function GetSpouseCliamDetailTable(ssn, DependentSeq) {
        $('#claim').val("");
        $('#servicedate').val("");
        $('#to').val("");
        $('#dep').val("");
        $('#DEPSEQ').val(DependentSeq);
        GetCliamDetailTable(ssn);
    }
    function Reset(SSN) {
        debugger;
        $('#claim').val("");
        $('#Fromservicedate').val("");
        $('#Toservicedate').val("");
        $('#dep').val("");
        $('#DEPSEQ').val(0);
        GetCliamDetailTable(SSN);
    }
    function GetCliamDetailTable(SSN) {

        var Fromdate = "";
        var Todate = "";
        if ($('#Fromservicedate').val() !="") {
            Fromdate = (new Date($('#Fromservicedate').val())).toISOString();
        }
        if ($('#Toservicedate').val() != "") {
            Todate = (new Date($('#Toservicedate').val())).toISOString();
        }
        $('.loader-main').show();

            $.ajax({
                type: "GET",
                url:'@Url.Action("GetCliamDetailTable", "MemberDetails")',
                data: { page: 1, SSN: SSN, DependentSeq: $('#DEPSEQ').val(), ClaimNumber: $('#claim').val(), Fromdate: Fromdate, Todate: Todate},
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (response2) {
                    $('.loader-main').hide();

                    $('#claimDetailGrid').html(response2.viewContent);

                },
                failure: function (response2) {
                    alert(response2.d);
                },
                error: function (response2) {
                    alert(response2.d);
                }
            });
    };

    function ExportTable(SSN) {
        var Fromdate = "";
        var Todate = "";
        if ($('#Fromservicedate').val() != "") {
            Fromdate = (new Date($('#Fromservicedate').val())).toISOString();
        }
        if ($('#Toservicedate').val() != "") {
            Todate = (new Date($('#Toservicedate').val())).toISOString();
        }
         $.ajax({
             type: "POST",

            url: '@Url.Action("ExportExcel", "MemberDetails")',
            //contentType: "application/json; charset=utf-8",
             dataType: "json",
             data: { SSN: SSN, DEPSEQ: $('#DEPSEQ').val(), claim: $('#claim').val(),Fromdate: Fromdate, Todate: Todate},
        }).done(function (data) {
            //get the file name for download
            if (data.fileName != "") {
                $("#wait").css("display", "none");
                   window.location.href = "@Url.RouteUrl(new { Controller = "MemberDetails", Action = "Download" })/?fileName=" + data.fileName;
                   }
        });

    }

    async function IdCardRequest(SSN, Name, Gender) {
        const { value: text } =await Swal.fire({
            input: 'textarea',
            inputLabel: 'Notes',
            inputPlaceholder: 'Type your message here...',
            inputAttributes: {
                'aria-label': 'Type your message here'
            },
            showCancelButton: true
        })

        if (text) {

            $.ajax({
                type: "GET",
                url:'@Url.Action("IdCardRequest", "MemberDetails")',
                data: { SSN: SSN, Notes: text, Name: Name, Gender: Gender},
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (response1) {
                    if (response1 == true) {
                        $('.IdCardRequest').remove();
                    }
                    else {
                        alert("false")
                    }

                },
                failure: function (response1) {
                    alert(response1.d);
                },
                error: function (response1) {
                    alert(response1.d);
                }
            });
        }
    }
</script>